<div class="container">
  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div style="display: flex; align-items: center;">
        <img src="assets/bankpng.png" alt="bank icon" style="height: 50px; margin-right: 10px;">
        <h2>Arquivos de Retorno</h2>
      </div>
      <button class="btn-secondary" (click)="goBack()">Voltar</button>
    </div>

    <!-- Search Filter -->
    <div class="search-container">
      <div class="search-group">
        <label for="jobFilter">Filtrar por Job:</label>
        <select 
          id="jobFilter" 
          [(ngModel)]="selectedJobId" 
          (change)="searchByJobId()" 
          class="job-select">
          <option *ngFor="let job of jobs" [value]="job.id">
            {{ job.nome.length > 30 ? (job.nome | slice:0:30) + '...' : job.nome }}
          </option>
        </select>
        <button class="btn-clear" (click)="clearFilter()" [disabled]="!selectedJobId">
          Limpar Filtro
        </button>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading">
      <p>Carregando arquivos...</p>
    </div>

    <div *ngIf="!isLoading">
      <p class="results-count">{{ arquivos.length }} arquivo(s) encontrado(s)</p>
      
      <table class="table" *ngIf="arquivos.length > 0">
        <thead>
          <tr>
            <th>ID</th>
            <th>Job</th>
            <th>Nome do Arquivo</th>
            <th>Status</th>
            <th>Data Processamento</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let arquivo of arquivos">
            <td>{{ arquivo.id }}</td>
            <td>{{ arquivo.jobNome.length > 15 ? (arquivo.jobNome | slice:0:15) + '...' : arquivo.jobNome }}</td>
            <td>{{ arquivo.nomeArquivo.length > 20 ? (arquivo.nomeArquivo | slice:0:20) + '...' : arquivo.nomeArquivo }}</td>
            <td>
              <span [class]="getStatusClass(arquivo.status)">
                {{ arquivo.status }}
              </span>
            </td>
            <td>{{ arquivo.dataProcessamento | date:'dd/MM/yyyy HH:mm:ss' }}</td>
            <td>
              <button class="btn-info" (click)="viewDetails(arquivo.id)">
                Ver Conteúdo
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="arquivos.length === 0" class="no-results">
        <p>Nenhum arquivo de retorno encontrado.</p>
      </div>
    </div>
  </div>

  <app-modal 
    [isOpen]="isModalOpen" 
    [title]="modalTitle" 
    (closeModal)="closeModal()">
    <div class="file-content-container">
      <div *ngIf="isLoadingContent" class="loading-content">
        <p>Carregando conteúdo do arquivo...</p>
      </div>
      <div *ngIf="!isLoadingContent" class="file-content">
        <pre>{{ fileContent }}</pre>
      </div>
    </div>
  </app-modal>
</div>